<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/general-fragments :: head('YNPay :: Settings')}"></head>

<body data-theme="theme-AppleGreen" class="svgstroke-a">
<main class="container-fluid px-0">
	<!-- start: page menu link -->
	<div th:replace="~{fragments/general-fragments :: sidebar}"></div>
	<div class="content">
		<!-- start: page header -->
		<div th:replace="~{fragments/general-fragments :: main-header('Settings')}"></div>
		<!-- start: page header area -->
		<div class="px-xl-5 px-lg-4 px-3 py-2 page-header flex-wrap">
			<ol class="breadcrumb mb-0 bg-transparent mb-3 mb-sm-0">
				<li class="breadcrumb-item">
					<a class="text-muted" href="dashboard.html" title="home" th:href="@{/ui/home}">Home</a>
				</li>
				<li
						aria-current="page"
						class="breadcrumb-item active"
						title="Balance"
				>
					Settings
				</li>
			</ol>
		</div>
		<!-- start: page body area -->
		<div class="px-xl-5 px-lg-4 px-3 py-3 page-body">
			<div class="row">
				<div class="col-8 offset-2">
					<div class="card ">
						<div class="card-header bg-card pb-3">
							<h6 class="card-title mb-0">My Profile</h6>
							<div class="dropdown card-action">
								<a href="#" class="card-fullscreen" data-bs-toggle="tooltip"
								   title="Card Full Screen">
									<svg class="svg-stroke" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
										<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
										<path d="M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9"></path>
										<path d="M7 20l10 0"></path>
										<path d="M9 16l0 4"></path>
										<path d="M15 16l0 4"></path>
										<path d="M17 4h4v4"></path>
										<path d="M16 9l5 -5"></path>
									</svg>
								</a>
							</div>
							<div
									class="d-flex align-items-md-start align-items-center flex-column flex-md-row mt-4 w-100">

								<img alt="Profile Picture" src="../static/images/profile_av.png"
								     class="rounded-4"
								     onerror="this.onerror=null; this.src='/images/profile_av.png';"
								     width="160"
								     height="160"
								     th:if="@{/ui/uploads/picture{username}3.jpg(username=${userDisplay.username})}"
								     th:src="@{/ui/uploads/picture{username}3.jpg(username=${userDisplay.username})}"/>

								<div class="media-body ms-md-5 m-0 mt-4 mt-md-0 text-md-start text-center">
									<h4 class="mt-3" th:text="${userDisplay.fullName}">Michelle Hughes</h4>
								</div>

								<div class="ms-md-auto align-self-md-end d-flex">
									<button class="btn btn-grey-outline me-1" data-bs-toggle="modal"
									        data-bs-target="#editModal">
										<svg class="w-6 h-6 pb-1" aria-hidden="true"
										     xmlns="http://www.w3.org/2000/svg" width="18"
										     fill="none" viewBox="0 0 24 24">
											<path stroke="currentColor" stroke-linecap="round"
											      stroke-linejoin="round" stroke-width="2"
											      d="M10.779 17.779 4.36 19.918 6.5 13.5m4.279 4.279 8.364-8.643a3.027 3.027 0 0 0-2.14-5.165 3.03 3.03 0 0 0-2.14.886L6.5 13.5m4.279 4.279L6.499 13.5m2.14 2.14 6.213-6.504M12.75 7.04 17 11.28">
											</path>

										</svg>
										Edit
									</button>


									<form action="#" id="deleteUser" method="post"
									      onsubmit="return confirm('Are you sure you want to delete this user?');"
									      th:action="@{/ui/users}">
										<input name="_method" th:value="delete" type="hidden"/>
										<button class="btn btn-outline-danger justify-content-center align-items-center ms-2">
											<svg width="18" fill="currentColor" stroke="currentColor" class="pb-1"
											     viewBox="0 0 408.483 408.483" xml:space="preserve"><g stroke-width="0"></g>
												<g id="SVGRepo_tracerCarrier"></g>
												<g> <g> <g> <path stroke="currentColor"
												                  d="M87.748,388.784c0.461,11.01,9.521,19.699,20.539,19.699h191.911c11.018,0,20.078-8.689,20.539-19.699l13.705-289.316 H74.043L87.748,388.784z M247.655,171.329c0-4.61,3.738-8.349,8.35-8.349h13.355c4.609,0,8.35,3.738,8.35,8.349v165.293 c0,4.611-3.738,8.349-8.35,8.349h-13.355c-4.61,0-8.35-3.736-8.35-8.349V171.329z M189.216,171.329 c0-4.61,3.738-8.349,8.349-8.349h13.355c4.609,0,8.349,3.738,8.349,8.349v165.293c0,4.611-3.737,8.349-8.349,8.349h-13.355 c-4.61,0-8.349-3.736-8.349-8.349V171.329L189.216,171.329z M130.775,171.329c0-4.61,3.738-8.349,8.349-8.349h13.356 c4.61,0,8.349,3.738,8.349,8.349v165.293c0,4.611-3.738,8.349-8.349,8.349h-13.356c-4.61,0-8.349-3.736-8.349-8.349V171.329z"></path>
													<path stroke="currentColor"
													      d="M343.567,21.043h-88.535V4.305c0-2.377-1.927-4.305-4.305-4.305h-92.971c-2.377,0-4.304,1.928-4.304,4.305v16.737H64.916 c-7.125,0-12.9,5.776-12.9,12.901V74.47h304.451V33.944C356.467,26.819,350.692,21.043,343.567,21.043z"></path> </g> </g> </g></svg>
											Delete
										</button>
									</form>

								</div>
							</div>
						</div>
						<div class="card-body w-100">
							<div class="tab-content" id="pills-tabContent">
								<!--=== Account ===-->
								<div class="tab-pane fade show active" id="pills-home" role="tabpanel"
								     aria-labelledby="pills-home-tab" tabindex="0">
									<div class="table-responsive custom_scroll">
										<!-- Table -->
										<table class="table table-hover mt-3">
											<tbody>
											<tr style="height:55px!important;">

												<th class="border-top align-content-center">Full Name</th>
												<td class="text-end border-top align-content-center"
												    th:text="${userDisplay.fullName}"></td>
											</tr>
											<tr style="height:55px!important;">
												<th class="align-content-center">Username</th>
												<td class="text-end align-content-center"
												    th:text="${userDisplay.username}">lizameliza
												</td>
											</tr>
											<tr style="height:55px!important;">
												<th class="align-content-center">Email Address</th>
												<td class="text-end align-content-center"
												    th:text="${userDisplay.emailAddress}">doeliza@gmail.com
												</td>
											</tr>
											<tr style="height:55px!important;">
												<th class="align-content-center">Phone Number</th>
												<td class="text-end align-content-center"
												    th:text="${userDisplay.phoneNumber}">12345678
												</td>
											</tr>
											<tr style="height:55px!important;">
												<th class="align-content-center"> Verification</th>
												<td class="text-end align-content-center">
													<button class="btn btn-outline-primary" data-bs-toggle="modal"
													        data-bs-target="#verifyModal"
													        th:if="${userDisplay.verifiedAt == null}">Verify
													</button>
													<span class="text-end align-content-center"
													      th:if="${userDisplay.verifiedAt != null}"> Verified</span>
												</td>
											</tr>

											<tr style="height:55px!important;">
												<th class="align-content-center"> Status</th>
												<td class="text-end align-content-center"
												    th:if="${userDisplay.isBlocked() == false}"> Active
												</td>
												<td class="text-end align-content-center"
												    th:if="${userDisplay.isBlocked()}"> Blocked
												</td>
											</tr>

											<tr>
												<th class="align-content-center"> Password</th>
												<td class="text-end align-content-center ">
													<a class="btn btn-outline-info"
													   th:href="@{/ui/auth/reset-password?token={token}(token=${token})}">
														Reset Password</a>
												</td>
											</tr>

											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</main>



<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="editModalLabel">Edit
					Account Details</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">

				<!-- Profile Photo -->
				<form class="text-center" enctype="multipart/form-data" method="post"
				      th:action="@{/ui/uploads/profile/{username}(username=${userDisplay.username})}">

					<div class="m-3 image-container">
						<input accept="image/jpeg, image/png, image/gif, image/bmp, image/webp"
						       class="d-none"
						       id="fileInput"
						       name="picture"
						       onchange="if(validateFile(this)) this.form.submit()" type="file"/>

						<img alt="Profile Picture"
						     class="rounded-circle border mb-3 profile-picture ms-auto"
						     onclick="document.getElementById('fileInput').click()"
						     width="160"
						     height="160"
						     onerror="this.onerror=null; this.src='/images/profile_av.png';"
						     th:if="@{/ui/uploads/picture{username}3.jpg(username=${#authentication.name})}"
						     th:src="@{/ui/uploads/picture{username}3.jpg(username=${userDisplay.username})}"/>

						<div class="overlay-text">Click to change picture</div>

					</div>
				</form>

				<form th:object="${userUpdate}" method="post" th:action="@{/ui/users/settings}">
					<input name="_method" th:value="put" type="hidden"/>

					<!-- Full Name -->
					<div class="mb-3">
						<label for="fullName" class="form-label">Full
							Name</label>
						<input type="text" class="form-control" id="fullName" th:field="*{fullName}">
					</div>
					<!-- Email Address -->
					<div class="mb-3">
						<label for="email" class="form-label">Email
							Address</label>
						<input type="email" class="form-control" id="email" value="doeliza@gmail.com"
						       th:field="*{emailAddress}">
					</div>
					<!-- Phone Number -->
					<div class="mb-3">
						<label for="phone" class="form-label">Phone
							Number</label>
						<input type="text" class="form-control" id="phone" value="12345678" th:field="*{phoneNumber}">
					</div>
					<div class="modal-footer border-top-0">
						<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-grey-outline">Save</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- Verify Modal -->
<div class="modal fade" id="verifyModal" tabindex="-1" aria-labelledby="verifyModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="verifyModalLabel">Verify Identity</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form class="text-center d-flex flex-column gap-3" enctype="multipart/form-data" method="post"
				      th:action="@{/ui/uploads/verification/{username}(username=${userDisplay.username})}">
					<div class="row">

						<div class="col-6 d-flex flex-column justify-content-between align-items-center">
							<div>
								<img id="preview1" src="../static/images/gallery/idExample.jpg"
								     th:src="@{/images/gallery/idExample.jpg}" class="img-thumbnail mb-3"
								     alt="Preview ID"/>
							</div>
							<label for="picture1" class="btn btn-secondary">Upload ID</label>
							<input accept="image/jpeg, image/png, image/gif, image/bmp, image/webp"
							       id="picture1"
							       class="d-none"
							       name="picture"
							       type="file"
							       onchange="if(validateFile(this)) {updatePreview(event, 'preview1'); checkFiles();}"/>
						</div>

						<div class="col-6 d-flex flex-column justify-content-between align-items-center">
							<div>
								<img id="preview2" src="../static/images/gallery/selfieExample.png"
								     th:src="@{/images/gallery/selfieExample.png}" class="img-thumbnail mb-3"
								     alt="Preview Selfie"/>
							</div>
							<label for="picture2" class="btn btn-secondary">Upload Selfie</label>
							<input accept="image/jpeg, image/png, image/gif, image/bmp, image/webp"
							       class="d-none"
							       id="picture2"
							       name="picture"
							       type="file"
							       onchange="if(validateFile(this)) {updatePreview(event, 'preview2'); checkFiles();}"/>
						</div>
					</div>

					<button type="submit" class="btn btn-primary mt-4" id="verifyBtn" disabled>Verify</button>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

<!-- Error Toast Notification -->
<div id="errorToast" class="toast position-fixed top-0 start-50 translate-middle-x p-3 mt-3"
     role="alert" aria-live="assertive" aria-atomic="true"
     th:if="${errors}" style="z-index: 1050;">
	<div class="toast-header bg-danger rounded-2 text-white">
		<strong class="text-end">Error</strong>
		<button type="button" class="ms-auto btn-close btn-close-white" data-bs-dismiss="toast"
		        aria-label="Close"></button>
	</div>
	<div class="toast-body mt-2 ps-0">
		<ul class="mb-0">
			<li th:each="error : ${errors}" th:text="${error.defaultMessage}"></li>
		</ul>
	</div>
</div>


<!-- Error Toast Notification -->
<div id="errorToastUpload" class="toast position-fixed top-0 start-50 translate-middle-x p-3 mt-3"
     role="alert" aria-live="assertive" aria-atomic="true"
     th:if="${failUpload}" style="z-index: 1050;">
	<div class="toast-header bg-danger rounded-2 text-white">
		<strong class="text-end">Error</strong>
		<button type="button" class="ms-auto btn-close btn-close-white" data-bs-dismiss="toast"
		        aria-label="Close"></button>
	</div>
	<div class="toast-body mt-2 ps-0">
		<ul class="mb-0">
			<li> Picture uploading failed, please try again</li>
		</ul>
	</div>
</div>


<!-- Success Toast Notification -->
<div id="successToast" class="toast position-fixed top-0 start-50 translate-middle-x p-3 mt-3"
     role="alert" aria-live="assertive" aria-atomic="true"
     th:if="${successUpdate}" style="z-index: 1050;">
	<div class="toast-header bg-success rounded-2 text-white">
		<strong class="text-end">Success</strong>
		<button type="button" class="ms-auto btn-close btn-close-white" data-bs-dismiss="toast"
		        aria-label="Close"></button>
	</div>
	<div class="toast-body mt-2 ps-0">
		<ul class="mb-0">
			<li> User updated Successfully</li>
		</ul>
	</div>
</div>


<!-- Success Toast Notification -->
<div id="successToastUpload" class="toast position-fixed top-0 start-50 translate-middle-x p-3 mt-3"
     role="alert" aria-live="assertive" aria-atomic="true"
     th:if="${successUpload}" style="z-index: 1050;">
	<div class="toast-header bg-success rounded-2 text-white">
		<strong class="text-end">Success</strong>
		<button type="button" class="ms-auto btn-close btn-close-white" data-bs-dismiss="toast"
		        aria-label="Close"></button>
	</div>
	<div class="toast-body mt-2 ps-0">
		<ul class="mb-0">
			<li> Photos uploaded successfully</li>
		</ul>
	</div>
</div>

<div th:replace="~{fragments/general-fragments :: exchange-rate}"></div>
<th:block th:replace="~{fragments/general-fragments.html :: scripts}"></th:block>
<script src="../static/bundles/dataTables.bundle.js" th:src="@{/bundles/dataTables.bundle.js}"></script>
<script src="../static/bundles/sweetalert2.bundle.js" th:src="@{/bundles/sweetalert2.bundle.js}"></script>
<script>
    function updatePreview(event, previewId) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const previewImage = document.getElementById(previewId);
                previewImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    function validateFile(input) {
        const allowedTypes = ["image/jpeg", "image/png", "image/gif", "image/bmp", "image/webp"];
        const file = input.files[0];

        if (!file) return false;

        if (!allowedTypes.includes(file.type)) {
            alert("Invalid file type. Please upload an image (JPEG, PNG, GIF, BMP, WEBP).");
            input.value = "";
            return false;
        }

        return true;
    }

    function checkFiles() {
        const picture1 = document.getElementById("picture1").files.length;
        const picture2 = document.getElementById("picture2").files.length;
        const verifyBtn = document.getElementById("verifyBtn");

        if (picture1 > 0 && picture2 > 0) {
            verifyBtn.disabled = false;
        } else {
            verifyBtn.disabled = true;
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        let errorToastEl = document.getElementById('errorToast');
        if (errorToastEl) {
            let toast = new bootstrap.Toast(errorToastEl, {delay: 5000});
            toast.show();
        }

        let errorToastUpload = document.getElementById('errorToastUpload');
        if (errorToastUpload) {
            let toast = new bootstrap.Toast(errorToastUpload, {delay: 5000});
            toast.show();
        }

        let successToastUpdate = document.getElementById('successToast');
        if (successToastUpdate) {
            let toast = new bootstrap.Toast(successToastUpdate, {delay: 5000});
            toast.show();
        }

        let successToastUpload = document.getElementById('successToastUpload');
        if (successToastUpload) {
            let toast = new bootstrap.Toast(successToastUpload, {delay: 5000});
            toast.show();
        }


    });


</script>

</body>

</html>