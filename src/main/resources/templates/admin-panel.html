<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/general-fragments :: head('YNPay :: Admin Panel')}"></head>

<body class="svgstroke-a" data-theme="theme-AppleGreen">
<main class="container-fluid px-0">
	<!-- start: page menu link -->
	<div th:replace="~{fragments/general-fragments :: sidebar}"></div>
	<div class="content">
		<!-- start: page header -->
		<div th:replace="~{fragments/general-fragments :: main-header('Admin Panel')}"></div>
		<!-- start: page header area -->
		<div class="px-xl-5 px-lg-4 px-3 py-2 page-header flex-wrap">
			<ol class="breadcrumb mb-0 bg-transparent mb-3 mb-sm-0">
				<li class="breadcrumb-item">
					<a class="text-muted" href="index.html" title="home" th:href="@{/ui/users/dashboard}">Home</a>
				</li>
				<li
						aria-current="page"
						class="breadcrumb-item active"
						title="Balance"
				>
					Admin Panel
				</li>
			</ol>
			<ul class="list-unstyled action mb-0 row g-2">
				<li class="col-sm-6 col-6">
					<div>
						<input class="form-control" name="filter" type="date"/>
					</div>
				</li>
				<li class="dropdown col-sm-6 col-6">
					<a
							aria-expanded="false"
							class="btn border rounded fw-medium w-100"
							data-bs-auto-close="outside"
							data-bs-toggle="dropdown"
							href="#"
					>
						<svg
								class="svg-stroke"
								fill="none"
								stroke="currentColor"
								stroke-linecap="round"
								stroke-linejoin="round"
								viewBox="0 0 24 24"
								width="18"
								xmlns="http://www.w3.org/2000/svg"
						>
							<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
							<path
									d="M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z"
							></path>
						</svg>
						Filter
					</a>
					<div
							class="dropdown-menu dropdown-menu-end p-2 p-xl-3 shadow rounded-4"
							style="width: 300px"
					>
						<h6>Filter Options</h6>
						<div class="row g-3 mt-3">
							<div class="col-12">
								<label class="form-label small text-muted"
								>Sorted by:</label
								>
								<input
										class="form-control"
										placeholder="Search"
										type="search"
								/>
							</div>
							<div class="col-12">
								<label class="form-label small text-muted">Status:</label>
								<select class="form-select">
									<option selected="">Choose...</option>
									<option>...</option>
								</select>
							</div>
							<div class="col-12">
								<label class="form-label small text-muted"
								>Notifications:</label
								>
								<div class="form-check form-switch">
									<input
											class="form-check-input"
											role="switch"
											type="checkbox"
									/>
									<label class="form-check-label">Enabled</label>
								</div>
							</div>
							<div class="col-12 text-end mt-4">
								<button class="btn btn-sm btn-light me-1" type="reset">
									Reset
								</button>
								<button class="btn btn-sm btn-primary" type="submit">
									Apply
								</button>
							</div>
						</div>
					</div>
				</li>
			</ul>
		</div>
		<!-- start: page body area -->
		<div class="px-xl-5 px-lg-4 px-3 py-3 page-body">
			<div class="row">
				<div class="col-xxl-6 col-xl-12 col-lg-12">
					<div class="card mb-3">
						<div class="card-header">
							<h6 class="card-title mb-0">Transactions Overview</h6>
						</div>
						<div class="card-body">
							<div id="apex-basic-column"></div>
						</div>
					</div>
				</div>

				<div class="col-xxl-6 col-xl-12 col-lg-12">
					<div class="card mb-3">
						<div class="card-header">
							<h6 class="card-title mb-0">Users Overview</h6>
						</div>
						<div class="card-body">
							<div id="apex-chart-line-column" style="height: 280px"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="px-xl-5 px-lg-4 px-3 py-3 page-body">
			<div class="row">
				<div class="col-12">
					<div class="border p-4 rounded-2 rounded-4 card">
						<div
								class="calendar-tab pb-4"
								style="--dynamic-color: var(--primary-color)">

							<ul
									class="nav nav-pills text-muted text-uppercase"
									role="tablist"
							>
								<li class="nav-item">
									Sun
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_1"
											type="button"
											role="tab"
									>
										01
									</button>
								</li>
								<li class="nav-item">
									Mon
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_2"
											type="button"
											role="tab"
									>
										02
									</button>
								</li>
								<li class="nav-item">
									Tue
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_3"
											type="button"
											role="tab"
									>
										03
									</button>
								</li>
								<li class="nav-item">
									Wed
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_4"
											type="button"
											role="tab"
									>
										04
									</button>
								</li>
								<li class="nav-item">
									Thu
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_5"
											type="button"
											role="tab"
									>
										05
									</button>
								</li>
								<li class="nav-item">
									Fri
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_6"
											type="button"
											role="tab"
									>
										06
									</button>
								</li>
								<li class="nav-item">
									Sat
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_7"
											type="button"
											role="tab"
									>
										07
									</button>
								</li>
								<li class="nav-item">
									Sun
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_8"
											type="button"
											role="tab"
									>
										08
									</button>
								</li>
								<li class="nav-item">
									Mon
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_9"
											type="button"
											role="tab"
									>
										09
									</button>
								</li>
								<li class="nav-item">
									Tue
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_10"
											type="button"
											role="tab"
									>
										10
									</button>
								</li>
								<li class="nav-item">
									Wed
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_11"
											type="button"
											role="tab"
									>
										11
									</button>
								</li>
								<li class="nav-item">
									Thu
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_12"
											type="button"
											role="tab"
									>
										12
									</button>
								</li>
								<li class="nav-item">
									Fri
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_13"
											type="button"
											role="tab"
									>
										13
									</button>
								</li>
								<li class="nav-item">
									Sat
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_14"
											type="button"
											role="tab"
									>
										14
									</button>
								</li>
								<li class="nav-item">
									Sun
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_15"
											type="button"
											role="tab"
									>
										15
									</button>
								</li>
								<li class="nav-item">
									Sun
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_16"
											type="button"
											role="tab"
									>
										16
									</button>
								</li>
								<li class="nav-item">
									Mon
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_17"
											type="button"
											role="tab"
									>
										17
									</button>
								</li>
								<li class="nav-item">
									Tue
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_18"
											type="button"
											role="tab"
									>
										18
									</button>
								</li>
								<li class="nav-item">
									Wed
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_19"
											type="button"
											role="tab"
									>
										19
									</button>
								</li>
								<li class="nav-item">
									Thu
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_20"
											type="button"
											role="tab"
									>
										20
									</button>
								</li>
								<li class="nav-item">
									Fri
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_21"
											type="button"
											role="tab"
									>
										21
									</button>
								</li>
								<li class="nav-item">
									Sat
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_22"
											type="button"
											role="tab"
									>
										22
									</button>
								</li>
								<li class="nav-item">
									Sun
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_23"
											type="button"
											role="tab"
									>
										23
									</button>
								</li>
								<li class="nav-item">
									Mon
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_24"
											type="button"
											role="tab"
									>
										24
									</button>
								</li>
								<li class="nav-item">
									Tue
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_25"
											type="button"
											role="tab"
									>
										25
									</button>
								</li>
								<li class="nav-item">
									Wed
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_26"
											type="button"
											role="tab"
									>
										26
									</button>
								</li>
								<li class="nav-item">
									Thu
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_27"
											type="button"
											role="tab"
									>
										27
									</button>
								</li>
								<li class="nav-item">
									Fri
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_28"
											type="button"
											role="tab"
									>
										28
									</button>
								</li>
								<li class="nav-item">
									Sat
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_29"
											type="button"
											role="tab"
									>
										29
									</button>
								</li>
								<li class="nav-item">
									Sun
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_30"
											type="button"
											role="tab"
									>
										30
									</button>
								</li>

								<li class="nav-item">
									Mon
									<button
											class="nav-link disabled"
											data-bs-toggle="pill"
											data-bs-target="#c_date_31"
											type="button"
											role="tab"
									>
										31
									</button>
								</li>
							</ul>
						</div>
						<div class="d-flex justify-content-center">
							<button id="usersTab" class="btn btn-outline-primary rounded-pill me-2"> Users </button>

							<button id="transfersTab" class="btn btn-outline-info rounded-pill ms-2 info-btn"> Transfers </button>

							<button id="investmentsTab" class="btn btn-outline-warning rounded-pill ms-2 inv-btn"> Investments </button>
						</div>
						<table id="usersTable"
						       class="table align-middle table-hover dataTable table-body table-responsive w-100 border rounded-4">

							<thead>
							<tr class="small text-muted text-uppercase">

								<th class="border-end">Full Name</th>
								<th class="border-end">Username</th>
								<th class="border-end">Email</th>
								<th class="border-end">Phone Number</th>
								<th class="border-end">Status</th>
								<th>Options</th>
							</tr>
							</thead>
							<tbody>
							<tr class="row-selectable" th:each="user : ${users}">

								<td class="border-end border-top">
                                                       <span class="d-flex align-items-center">

	                                                       <img alt="Profile Picture" src="../static/images/xs/avatar1.jpg"
	                                                            class="avatar rounded-circle d-none d-sm-inline-block"
	                                                            onerror="this.onerror=null; this.src='/images/xs/avatar1.jpg';"
	                                                            th:if="@{/ui/uploads/picture{username}3.jpg(username=${user.username})}"
	                                                            th:src="@{/ui/uploads/picture{username}3.jpg(username=${user.username})}"/>
                                                            <span class="flex-fill ms-2">
                                                                 <span class="h6 mb-0" th:text="${user.fullName}">Jony Doe</span>
                                                            </span>
                                                       </span>
								</td>
								<td class="border-end border-top" th:text="${user.username}">johny devito</td>
								<td class="border-end border-top" th:text="${user.emailAddress}"> johny@gmail.com</td>
								<td class="border-end border-top" th:text="${user.phoneNumber}">+234234234</td>
								<td class="border-end border-top" th:text="${user.blocked ? 'Blocked' : 'Active'}"></td>
								<td class="border-top">
									<a aria-expanded="false" class="btn btn-outline-secondary w-100"
									   data-bs-toggle="offcanvas" th:href="'#offcanvas_userDetails' + ${user.id}"
									   title="More Action">
										<svg aria-hidden="true" class="w-6 h-6"
										     fill="none" viewBox="0 0 24 24"
										     width="24" xmlns="http://www.w3.org/2000/svg">
											<path d="M6 12h.01m6 0h.01m5.99 0h.01" stroke="currentColor"
											      stroke-linecap="round"
											      stroke-width="3"/>
										</svg>

									</a>
								</td>
								<div aria-labelledby="offcanvas_trdetails" class="offcanvas offcanvas-end" th:id="'offcanvas_userDetails' + ${user.id}" tabindex="-1">
									<div class="offcanvas-header">
										<h5 class="offcanvas-title">User Details</h5>
										<button aria-label="Close" class="btn-close" data-bs-dismiss="offcanvas" type="button"></button>
									</div>
									<div class="offcanvas-body px-0">

										<div class="mb-4 px-3">
											<div class="d-flex align-items-center mb-3">

												<img alt="Profile Picture" src="../static/images/xs/avatar1.jpg"
												     class="avatar rounded-circle d-none d-sm-inline-block"
												     onerror="this.onerror=null; this.src='/images/xs/avatar1.jpg';"
												     th:if="@{/ui/uploads/picture{username}3.jpg(username=${user.username})}"
												     th:src="@{/ui/uploads/picture{username}3.jpg(username=${user.username})}"/>

												<div class="flex-fill ms-3">
													<div class="h6 mb-1" th:text="${user.fullName}">Jony Doe</div>
													<small class="text-muted" th:text="${#temporals.format(user.getLastOnline(), 'yyyy-MM-dd HH:mm:ss')}">Last seen 12.03.2025</small>
												</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted mb-3" >Username</small>
												<div class="h6 mb-0 pt-3" th:text="${user.username}">jonidevito</div>
											</div>

											<div class="border-bottom py-3">
												<small class="text-muted mb-3">Email Address</small>
												<div class="h6 mb-0 pt-3" th:text="${user.emailAddress}">jonny@gmail.com</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted mb-3">Phone Number</small>
												<div class="h6 mb-0 pt-3" th:text="${user.phoneNumber}">+343423423423</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted mb-1">Verification</small>
												<div class="d-flex">
													<div class="h6 align-self-end" th:if="${user.getVerifiedAt() == null}"> Not Verified </div>
													<div class="h6 mb-0 pt-3" th:if="${user.getVerifiedAt() != null}"> Verified </div>
													<button class="ms-auto btn btn-outline-primary"  th:if="${user.getVerifiedAt() == null}" data-bs-toggle="modal" th:data-bs-target="'#verifyModal' + ${user.id}"> Verify </button>
												</div>
											</div>

											<div class="border-bottom py-3">
												<small class="text-muted mb-1">Status</small>
												<div class="d-flex">
													<div class="h6 align-self-end" th:text="${user.blocked ? 'Blocked' : 'Active'}"> </div>
													<form th:action="@{/ui/admin/users/{userId}/unblock(userId=${user.id})}" method="post">
														<input type="hidden" name="_method" value="PUT"/>
														<button type="submit" class="ms-auto btn btn-outline-primary" th:if="${user.isBlocked()}"> Unblock </button>
													</form>

													<form th:action="@{/ui/admin/users/{userId}/block(userId=${user.id})}" method="post">
														<input type="hidden" name="_method" value="PUT"/>
														<button type="submit" class="ms-auto btn btn-outline-danger" th:if="${!user.isBlocked()}" > Block </button>
													</form>
												</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted mb-1 align-self-start">Role</small>
												<div class="d-flex">
													<div class="h6 align-self-end " th:if="${user.isAdmin()}"> Admin </div>
													<div class="h6 align-self-end" th:if="${!user.isAdmin()}"> User </div>

													<form th:action="@{/ui/admin/users/{userId}/grant(userId=${user.id})}" method="post">
														<input type="hidden" name="_method" value="PUT"/>
														<button type="submit" class="ms-auto btn btn-outline-primary" th:if="${!user.isAdmin()}"> Promote </button>
													</form>

													<form th:action="@{/ui/admin/users/{userId}/revoke(userId=${user.id})}" method="post">
														<input type="hidden" name="_method" value="PUT"/>
														<button type="submit" class="ms-auto btn btn-outline-danger" th:if="${user.isAdmin()}" > Demote </button>
													</form>
												</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted mb-3" >Registration Date</small>
												<div class="d-flex">
													<div class="h6 align-self-end pt-3" th:text="${#temporals.format(user.getCreatedAt(), 'yyyy-MM-dd HH:mm:ss')}"> Feb 05, 2024 At 18:20 </div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- Verify Modal -->
								<div class="modal fade" th:id="'verifyModal' + ${user.id}" tabindex="-1" th:aria-labelledby="'verifyModalLabel' + ${user.id}" aria-hidden="true">
									<div class="modal-dialog modal-lg">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title" th:id="'verifyModalLabel' + ${user.id}">Verify Identity</h5>
												<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
											</div>
											<div class="modal-body">
												<form class="text-center d-flex flex-column gap-3" enctype="multipart/form-data" method="post">
													<div class="row">
														<div class="col-6 d-flex flex-column justify-content-between align-items-center">
															<div>
																<img alt="preview1" src="../static/images/gallery/no-image.png"
																     class="img-thumbnail mb-3"
																     onerror="this.onerror=null; this.src='/images/gallery/no-image.png'"
																     th:if="@{/ui/uploads/picture{username}1.jpg(username=${user.username})}"
																     th:src="@{/ui/uploads/picture{username}1.jpg(username=${user.username})}"
																     style="cursor:pointer;"
																     onclick="showFullScreen(this)"/>
															</div>


														</div>
														<div class="col-6 d-flex flex-column justify-content-between align-items-center">
															<div>
																<img alt="preview2" src="../static/images/gallery/no-image.png"
																     class="img-thumbnail mb-3"
																     onerror="this.onerror=null; this.src='/images/gallery/no-image.png'"
																     onclick="showFullScreen(this)"
																     style="cursor:pointer;"
																     th:if="@{/ui/uploads/picture{username}2.jpg(username=${user.username})}"
																     th:src="@{/ui/uploads/picture{username}2.jpg(username=${user.username})}"/>


															</div>
														</div>
													</div>
												</form>
											</div>
											<div class="modal-footer">
												<form th:action="@{/ui/admin/users/{username}/approve-verification(username=${user.username})}" method="post">
													<input type="hidden" name="_method" value="PUT"/>
													<button type="submit"  class="btn btn-primary  ">Approve</button>
												</form>

												<form th:action="@{/ui/admin/users/{username}/reject-verification(username=${user.username})}" method="post">
													<input type="hidden" name="_method" value="PUT"/>
													<button type="submit" class="btn btn-danger" >Reject</button>
												</form>
											</div>
										</div>
									</div>
								</div>
							</tr>
							</tbody>
						</table>

						<table id="transfersTable"
						       class="table align-middle table-hover dataTable table-body table-responsive w-100 border rounded-4">

							<thead>
							<tr class="small text-muted text-uppercase">

								<th class="border-end">From</th>
								<th class="border-end">Amount</th>
								<th class="border-end">Category</th>
								<th class="border-end">Date</th>
								<th class="border-end">Type</th>
								<th>More</th>
							</tr>
							</thead>
							<tbody>
							<tr class="row-selectable" th:each="transaction : ${transactions}">

								<td class="border-end border-top">
                                                       <span class="d-flex align-items-center">
                                                            <img alt=""
                                                                 class="avatar rounded-circle d-none d-sm-inline-block"
                                                                 src="../static/images/xs/avatar1.jpg"
                                                                 th:if="${transaction.transactionType !=  'Deposit'}"
                                                                 th:src="@{/images/xs/avatar1.jpg}">

	                                                       <img alt=""
	                                                            class="avatar rounded-circle d-none d-sm-inline-block"
	                                                            src="../static/images/payment/card.svg"
	                                                            th:if="${transaction.transactionType ==  'Deposit'}"
	                                                            th:src="@{/images/payment/card.svg}">
                                                            <span class="flex-fill ms-2">
                                                                 <span class="h6 mb-0" th:text="${transaction.sender}">Jony Doe</span>
                                                            </span>
                                                       </span>
								</td>
								<td class="border-end border-top" th:text="${transaction.amount} + ' ' + ${transaction.currency}">$500.00</td>
								<td class="border-end border-top" th:text="${transaction.transactionCategory}">Checking</td>
								<td class="border-end border-top" th:text="${#temporals.format(transaction.transactionTime, 'yyyy-MM-dd HH:mm:ss')}">Feb 05, 2024</td>
								<td class="border-end border-top" th:text="${transaction.transactionType}">Deposit</td>
								<td class="border-top">
									<a aria-expanded="false" class="btn btn-outline-secondary w-100"
									   data-bs-toggle="offcanvas"
									   th:href="'#offcanvas_trdetails_' + ${transaction.transactionId}"
									   title="More Action">
										<svg aria-hidden="true" class="w-6 h-6"
										     fill="none" viewBox="0 0 24 24"
										     width="24" xmlns="http://www.w3.org/2000/svg">
											<path d="M6 12h.01m6 0h.01m5.99 0h.01" stroke="currentColor"
											      stroke-linecap="round"
											      stroke-width="3"/>
										</svg>

									</a>
								</td>
								<!-- start: Transection details rate -->
								<div aria-labelledby="offcanvas_trdetails" class="offcanvas offcanvas-end" th:id="'offcanvas_trdetails_' + ${transaction.transactionId}"  tabindex="-1">
									<div class="offcanvas-header">
										<h5 class="offcanvas-title">Transaction Details</h5>
										<button aria-label="Close" class="btn-close" data-bs-dismiss="offcanvas" type="button"></button>
									</div>
									<div class="offcanvas-body px-0">
										<div class="mb-4 p-3 bg-light">
											<h6 class="text-muted mb-0">Amount</h6>
										</div>
										<div class="mb-4 px-3">
											<h3 th:text="${transaction.getAmount()}+ ' ' +${transaction.currency}">500.00</h3>
										</div>
										<div class="mb-4 p-3 bg-light">
											<h6 class="text-muted mb-0">To</h6>
										</div>
										<div class="mb-4 px-3">
											<div class="d-flex align-items-center mb-3">


												<img alt="wallet" src="../static/images/gallery/wallet-2.jpg"
												     class="avatar rounded-4 d-none d-sm-inline-block"
												     th:src="@{/images/gallery/wallet-2.jpg}">

												<div class="flex-fill ms-3">
													<div class="h6 mb-0"    th:text="${transaction.receivers}" > John Jones </div>
													<small class="text-muted" th:text="'IBAN33YNPAY68477732491843244' + ${transaction.receiverWalletId}">**** ****2498 DBS Bank</small>
												</div>
											</div>
										</div>
										<div class="mb-4 p-3 bg-light">
											<h6 class="text-muted mb-0 pt-3">Details</h6>
										</div>
										<div class="mb-4 px-3">
											<div class="border-bottom py-3">
												<small class="text-muted">Payment Type</small>
												<div class="h6 mb-0 pt-3">Internal Transfer</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted">Status</small>
												<div class="h6 mb-0 pt-3">Complete</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted">Transaction Id</small>
												<div class="h6 mb-0 pt-3" th:text="'NVF253688' + ${transaction.transactionId}">NVF25680222</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted">Date &amp; Time</small>
												<div class="h6 mb-0 pt-3" th:text="${#temporals.format(transaction.transactionTime, 'yyyy-MM-dd HH:mm:ss')}">Feb 05, 2024 At 18:20</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted">Message</small>
												<div class="h6 mb-0 pt-3" th:text="${transaction.getMessage()}">#4433</div>
											</div>
										</div>
									</div>
								</div>
							</tr>
							</tbody>
						</table>

						<table id="investmentsTable"
						       class="table align-middle table-hover dataTable table-body table-responsive w-100 border rounded-4">

							<thead>
							<tr class="small text-muted text-uppercase">

								<th class="border-end">From</th>
								<th class="border-end">Symbol</th>
								<th class="border-end">Quantity</th>
								<th class="border-end">Price</th>
								<th class="border-end">Direction</th>
								<th class="border-end">Date</th>
								<th>More</th>
							</tr>
							</thead>
							<tbody>
							<tr class="row-selectable" th:each="investment : ${investments}">

								<td class="border-end border-top">
                                                       <span class="d-flex align-items-center">

	                                                       <img alt="Profile Picture" src="../static/images/xs/avatar1.jpg"
	                                                            class="avatar rounded-circle d-none d-sm-inline-block"
	                                                            onerror="this.onerror=null; this.src='/images/xs/avatar1.jpg';"
	                                                            th:if="@{/ui/uploads/picture{username}3.jpg(username=${investment.username})}"
	                                                            th:src="@{/ui/uploads/picture{username}3.jpg(username=${investment.username})}"/>
                                                            <span class="flex-fill ms-2">
                                                                 <span class="h6 mb-0" th:text="${investment.username}"> Username </span>
                                                            </span>
                                                       </span>
								</td>
								<td class="border-end border-top" th:text="${investment.symbol}"> Symbol </td>
								<td class="border-end border-top" th:text="${investment.quantity}">Quantity</td>
								<td class="border-end border-top" th:text="${investment.value} + ' USD'">Price</td>
								<td class="border-end border-top" th:text="${investment.type}">Direction</td>
								<td class="border-end border-top" th:text="${#temporals.format(investment.purchasedAt, 'yyyy-MM-dd HH:mm:ss')}"> Date </td>
								<td class="border-top">
									<a aria-expanded="false" class="btn btn-outline-secondary w-100"
									   data-bs-toggle="offcanvas"
									   th:href="'#offcanvas_invstdetails_' + ${investment.id}"
									   title="More Action">
										<svg aria-hidden="true" class="w-6 h-6"
										     fill="none" viewBox="0 0 24 24"
										     width="24" xmlns="http://www.w3.org/2000/svg">
											<path d="M6 12h.01m6 0h.01m5.99 0h.01" stroke="currentColor"
											      stroke-linecap="round"
											      stroke-width="3"/>
										</svg>

									</a>
								</td>
								<!-- start: Transection details rate -->
								<div aria-labelledby="offcanvas_invstdetails_" class="offcanvas offcanvas-end" th:id="'offcanvas_invstdetails_' + ${investment.id}"  tabindex="-1">
									<div class="offcanvas-header">
										<h5 class="offcanvas-title">Investment Details</h5>
										<button aria-label="Close" class="btn-close" data-bs-dismiss="offcanvas" type="button"></button>
									</div>
									<div class="offcanvas-body px-0">
										<div class="mb-4 p-3 bg-light">
											<h6 class="text-muted mb-0">Value</h6>
										</div>
										<div class="mb-4 px-3">
											<h3 th:text="${investment.value} + ' USD'">500.00</h3>
										</div>
										<div class="mb-4 p-3 bg-light">
											<h6 class="text-muted mb-0">To</h6>
										</div>
										<div class="mb-4 px-3">
											<div class="d-flex align-items-center mb-3">


												<img alt="wallet" src="../static/images/stock-icons/nyse.png"
												     class="avatar rounded-4 d-none d-sm-inline-block"
												     th:src="@{/images/stock-icons/nyse.png}">

												<div class="flex-fill ms-3">
													<div class="h6 mb-0"  > New York Stock Exchange </div>
												</div>
											</div>
										</div>
										<div class="mb-4 p-3 bg-light">
											<h6 class="text-muted mb-0 pt-3">Details</h6>
										</div>
										<div class="mb-4 px-3">
											<div class="border-bottom py-3">
												<small class="text-muted">Payment Type</small>
												<div class="h6 mb-0 pt-3">Investment</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted">Order Total Value</small>
												<div class="h6 mb-0 pt-3" th:text="${investment.getTotalOrderValue()} + ' USD'"></div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted">Status</small>
												<div class="h6 mb-0 pt-3">Complete</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted">Transaction Id</small>
												<div class="h6 mb-0 pt-3" th:text="'NVF253688' + ${investment.id}">NVF25680222</div>
											</div>
											<div class="border-bottom py-3">
												<small class="text-muted">Date &amp; Time</small>
												<div class="h6 mb-0 pt-3" th:text="${#temporals.format(investment.purchasedAt, 'yyyy-MM-dd HH:mm:ss')}">Feb 05, 2024 At 18:20</div>
											</div>
										</div>
									</div>
								</div>
							</tr>
							</tbody>
						</table>

					</div>
				</div>
			</div>
		</div>
	</div>
</main>



<div th:replace="~{fragments/general-fragments :: exchange-rate}"></div>

<th:block th:replace="~{fragments/general-fragments.html :: scripts}"></th:block>

<script src="../static/bundles/dataTables.bundle.js" th:src="@{/bundles/dataTables.bundle.js}"></script>

<link href="../static/vendor/dataTables.css" rel="stylesheet" th:href="@{/vendor/dataTables.css}"/>

<script th:inline="javascript">

    const conversionRates = {
        EUR: 1.09,
        GBP: 1.30,
        USD: 1,
    };

    const today = new Date().getDate();

    let allDates = document.querySelectorAll('.nav-link');


    allDates.forEach(date => {
        let dateNumber = parseInt(date.textContent);

        if (dateNumber === today) {
            date.classList.add('active');
        }
    });

    document.addEventListener("DOMContentLoaded", function () {
        // Scroll handling for .calendar-tab .nav
        const scrollContainer = document.querySelector(".calendar-tab .nav");
        if (scrollContainer) {
            scrollContainer.addEventListener("wheel", (evt) => {
                evt.preventDefault();
                scrollContainer.scrollLeft += evt.deltaY;
            });
        }
    });

    $(document).ready(function () {
        // Initialize DataTable
        let usersTable = $('#usersTable').DataTable({
            responsive: true,
        });

        let investmentsTable = $('#investmentsTable').DataTable({
            responsive: true,
            "columnDefs": [
                {
                    "targets": 3,
                    "render": function (data, type, row) {

                        if (type === 'display') {
                            return data;
                        }

                        let num = data.match(/[-+]?[0-9]*\.?[0-9]+/);
                        return num ? parseFloat(num[0]) : data;
                    },
                    "orderDataType": "numeric"
                }
            ]
        });

        let transfersTable = $('#transfersTable').DataTable({
            responsive: true,
            "columnDefs": [
                {
                    "targets": 1,
                    "render": function (data, type, row) {


                        if (type === 'display') {
                            return data;
                        }

                        let rate = conversionRates[data.slice(-3)];

                        let num = data.match(/[-+]?[0-9]*\.?[0-9]+/);
                        return num ? parseFloat(num[0]) * rate : data;
                    },
                    "orderDataType": "numeric"
                }
            ]
        });

        $('#transfersTable_wrapper').hide();
        $('#investmentsTable_wrapper').hide();

        $('#usersTab').on('click', function () {
            $(this).addClass('active');
            $('#transfersTab').removeClass('active');
            $('#investmentsTab').removeClass('active');
            $('#usersTable_wrapper').show();
            $('#transfersTable_wrapper').hide();
            $('#investmentsTable_wrapper').hide();
            usersTable.columns.adjust().responsive.recalc();
        });

        $('#investmentsTab').on('click', function () {
            $(this).addClass('active');
            $('#transfersTab').removeClass('active');
            $('#usersTab').removeClass('active');
            $('#investmentsTable_wrapper').show();
            $('#usersTable_wrapper').hide();
            $('#transfersTable_wrapper').hide();
            investmentsTable.columns.adjust().responsive.recalc();
        });

        $('#transfersTab').on('click', function () {
            $(this).addClass('active');
            $('#usersTab').removeClass('active');
            $('#investmentsTab').removeClass('active');
            $('#transfersTable_wrapper').show();
            $('#usersTable_wrapper').hide();
            $('#investmentsTable_wrapper').hide();
            transfersTable.columns.adjust().responsive.recalc();
        });
    });

    $(document).ready(function () {

        var users = /*[[${users}]]*/ [];

        var monthLabels = [];
        var createdCounts = Array(12).fill(0);
        var verifiedCounts = Array(12).fill(0);

        var now = new Date();
        var currentYear = now.getFullYear();
        var currentMonth = now.getMonth();


        for (let i = 0; i < 12; i++) {
            let month = new Date(currentYear, currentMonth - i, 1);
            monthLabels.unshift(month);
        }



        users.forEach(user => {
            let createdAt = new Date(user.createdAt);
            let verifiedAt = user.verifiedAt ? new Date(user.verifiedAt) : null;

            for (let i = 0; i < 12; i++) {
                let month = new Date(currentYear, currentMonth - i, 1);

                if (
                    createdAt.getFullYear() === month.getFullYear() &&
                    createdAt.getMonth() === month.getMonth()
                ) {
                    createdCounts[11-i]++;
                }

                if (
                    verifiedAt &&
                    verifiedAt.getFullYear() === month.getFullYear() &&
                    verifiedAt.getMonth() === month.getMonth()
                ) {
                    verifiedCounts[11-i]++;
                }
            }
        });


        let formattedLabels = monthLabels.map(dateStr => {
            let date = new Date(dateStr);
            return date.toLocaleString("en-US", { month: "short" }).slice(0, 3);
        });


        // Create the chart
        var options = {
            chart: {
                height: 500,
                type: "line",
                toolbar: {
                    show: false,
                },
            },
            colors: ["var(--theme-color2)", "var(--theme-color4)"],
            series: [
                {
                    name: "Created Users",
                    type: "column",
                    data: createdCounts,
                },
                {
                    name: "Verified Users",
                    type: "line",
                    data: verifiedCounts,
                },
            ],
            stroke: {
                width: [0, 4],
            },
            labels: formattedLabels,
            xaxis: {
                type: "category",
            },
            yaxis: [
                {
                    title: {
                        text: "Registered Users",
                    },
                },
                {
                    opposite: true,
                    title: {
                        text: "Verified Users",
                    },
                },
            ],
            tooltip: {
                theme: "dark",
            },
        };

        var chart = new ApexCharts(
            document.querySelector("#apex-chart-line-column"),
            options
        );
        chart.render();
    });

    $(document).ready(function () {

        var transactions = /*[[${transactions}]]*/[];

        var investments = /*[[${investments}]]*/[];




        let depositCounts = Array(12).fill(0);
        let transferCounts = Array(12).fill(0);
        let monthLabels = [];


        const currentDate = new Date();
        const currentMonth = currentDate.getMonth();
        const currentYear = currentDate.getFullYear();


        for (let i = 0; i < 12; i++) {
            let month = new Date(currentYear, currentMonth - i, 1);
            monthLabels.unshift(month);
        }

        let investmentCounts = Array(12).fill(0);

        investments.forEach((investment) => {
            const purchaseDate = new Date(investment.purchasedAt);
            const purchaseMonth = purchaseDate.getMonth();
            const purchaseYear = purchaseDate.getFullYear();

            const monthDiff = currentMonth - purchaseMonth + (currentYear - purchaseYear) * 12;
            if (monthDiff >= 0 && monthDiff < 12) {
                investmentCounts[11 - monthDiff] += investment.totalOrderValue;
            }
        });


        let formattedLabels = monthLabels.map(dateStr => {
            let date = new Date(dateStr);
            return date.toLocaleString("en-US", { month: "short" }).slice(0, 3);
        });


        transactions.forEach((transaction) => {

            const transactionDate = new Date(transaction.transactionTime);
            const transactionMonth = transactionDate.getMonth();
            const transactionYear = transactionDate.getFullYear();


            const conversionRate = conversionRates[transaction.currency];
            const amountInUSD = transaction.amount * conversionRate;

            const monthDiff = currentMonth - transactionMonth + (currentYear - transactionYear) * 12;

            if (monthDiff >= 0 && monthDiff < 12) {

                if (transaction.transactionType === "Deposit") {
                    depositCounts[11 - monthDiff] += amountInUSD;
                } else if (transaction.transactionType === "Internal Transfer") {
                    transferCounts[11 - monthDiff] += amountInUSD;
                }
            }
        });

        var options = {
            chart: {
                height: 500,
                type: "bar",
            },
            colors: [
                "var(--theme-color2)",
                "var(--theme-color3)",
	            "var(--theme-color4)",
            ],
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: "55%",
                    endingShape: "rounded",
                },
            },
            dataLabels: {
                enabled: false,
            },
            stroke: {
                show: true,
                width: 2,
                colors: ["transparent"],
            },
            series: [
                {
                    name: "Deposits",
                    data: depositCounts,
                },
                {
                    name: "Internal Transfers",
                    data: transferCounts,
                },
                {
                    name: "Investments",
                    data: investmentCounts,
                },
            ],
            xaxis: {
                categories: formattedLabels,
            },
            yaxis: {
	            labels:{
                    formatter: function(val) {
                        return "$ " + val.toFixed(2); // Limits the decimal places to 2 for Y-axis labels
                    },
	            }
            },
            fill: {
                opacity: 1,
            },
            tooltip: {
                theme: "dark",
                y: {
                    formatter: function (val) {
                        return "$ " + val.toFixed(2);
                    },
                },
            },
        };


        var chart = new ApexCharts(
            document.querySelector("#apex-basic-column"),
            options
        );
        chart.render();
    });

    function showFullScreen(img) {
        const fullScreenDiv = document.createElement("div");
        fullScreenDiv.style.position = "fixed";
        fullScreenDiv.style.top = "0";
        fullScreenDiv.style.left = "0";
        fullScreenDiv.style.width = "100vw";
        fullScreenDiv.style.height = "100vh";
        fullScreenDiv.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
        fullScreenDiv.style.display = "flex";
        fullScreenDiv.style.justifyContent = "center";
        fullScreenDiv.style.alignItems = "center";
        fullScreenDiv.style.zIndex = "99999";

        const fullScreenImg = document.createElement("img");
        fullScreenImg.src = img.src;
        fullScreenImg.style.maxWidth = "90%";
        fullScreenImg.style.maxHeight = "90%";
        fullScreenImg.style.borderRadius = "10px";
        fullScreenImg.style.boxShadow = "0 4px 10px rgba(0,0,0,0.3)";

        fullScreenDiv.appendChild(fullScreenImg);

        fullScreenDiv.onclick = function() {
            document.body.removeChild(fullScreenDiv);
        };

        document.body.appendChild(fullScreenDiv);
    }
</script>


</body>
</html>
